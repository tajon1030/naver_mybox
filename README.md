# naver_mybox

## 시스템 구조도
![image](https://github.com/tajon1030/naver_mybox/assets/60431816/8651f63c-3470-4137-9913-9cbbf9ba4d0a)  

NCP Classic Server CentOS 7.8 Compact버전 사용하여 서버 배포  
CI/CD 는 GithubActions를 이용하여 main/dev 브랜치에 PR생성시 CI가 이루어지도록 하고,  
main브랜치 merge시 지속적 배포가 이루어지도록 하였음  
DB서버는 따로 분리하지않고 하나의 서버에 구현하였음  

## API 목록
[postman-document](https://documenter.getpostman.com/view/24793112/2s9Y5TyjpA)

## ERD / DB Schema
![image](https://github.com/tajon1030/naver_mybox/assets/60431816/3e04e4cb-f1fe-485a-a397-c8c4183b817b)
### 설계를 위해 참고한 사이트
[카테고리, 댓글/답글과 같은 계층(트리) 데이터베이스 구조 설계 및 개선하기](https://annahxxl.tistory.com/5)  
[트리-친화적이지-않은-테이블](https://awayday.github.io/2017-11-05/anti-tree-table/)  

## 기술적으로 고민한 부분
### 1. 계층형 폴더 구조는 어떻게 구현해야할까?  
처음에는 폴더에 부모키 컬럼(parent_folder_id)을 추가하는 방식을 생각하였다.  
부모키 컬럼을 추가하면 인접하는 부모데이터와 자식데이터를 쉽게 찾을수 있다는 장점이 있다.  
하지만 해당 방식으로는 하위 모든 깊이의 자식노드 조회가 어렵다는 단점이 있으며  
그런 단점은 이번에 구현하려는 프로젝트에서는 적합하지 않다고 생각해 다른 방식을 찾아보게 되었다.  
(ex 특정 폴더를 삭제할때 하위폴더를 모두 삭제하는 기능이 필요 -> 하위 노드를 파악하기위해 join을 반복해야한다는 문제점)  

부모키 컬럼을 추가하는 방식 외에도 세가지 방식을 더 찾을수 있었는데  
그중 하나는 경로나열의 방식이다.  
반드시 참조가 필요하다는 발상에서 벗어나 경로Path를 나타내는 문자열을 컬럼에 추가하여 부모 참조의 문제점을 해결할 수 있다.  
(쿼리 예 `SELECT * FROM Folder WHERE path LIKE '1/4/%';`)  
문자열 기반의 경로는 테이블 컬럼 선언에 의해 길이가 제한받기때문에 다른 방식을 더 찾아보았다.  

두번째 대안으로 찾은 방식은 중첩집합 방식이었는데  
해당 방식은 부모노드를 저장하는 대신 자손 집합에 대한 정보를 저장한다.  
트리구조가 변경될때마다 왼쪽과 오른쪽의 값을 다시 계산해주어야한다는 단점과  
사실 지금으로서는 수학적으로 머리를 굴려서 문제를 해결하는 방식이 오히려 혼란이 가중될 것같아 선택지에서 제외하였다.  

마지막으로 이번 프로젝트에서 채택한 방식인 클로저 테이블 방식에 대해 찾을 수 있었는데,  
노드간 연관관계를 추가적인 테이블에 저장하는 방식으로  
자기 자신을 포함(ancestor = descendant)하여 자식 노드 정보를 모두 저장한다.  
별도 테이블을 구성하고 저장공간을 많이 차지한다는 단점이 있었지만,  
조상이나 자손을 조회하는 쿼리가 직관적이라는 장점으로 채택하였다.  
추가로 인접한 부모와 자손의 조회를 더욱 편하게 하기 위해서 깊이Depth 컬럼을 추가하여 사용하였다.

### 2. 패키지 분리에 대하여
현재는 폴더와 파일의 패키지를 분리해놓은 상태이다.  
하지만 해당 기능들을 구분하여 패키지를 분리해야할 이유가 있는지에 대해 의문이 들어  
해당 리소스가 폴더인지 파일인지만 구분하는 플래그만 추가하여 처리하는 방식에 대해서 고민해보았다.  
크게보면 폴더나 파일이나 같은 리소스로 보아도 무방하지않을까?  
같은 리소스로 처리하면 페이징 처리를 함에 있어서도 한결 수월한 처리가 가능하지 않을까 하는 생각이 든다.  
적어도 Service단을 분리하더라도 Controller단은 합쳐서 구현하는편이 더 깔끔할것이라고 생각하여 추후 수정할 것이다.


## 개선 필요 내용들
- [ ] 1. 테스트 코드 작성하기  
- [ ] 2. 시스템 구조 변경하기(DB서버분리, 80포트로 포트포워딩 필요)  
- [ ] 3. validation 추가하기(폴더 삭제기능: 루트 폴더 삭제하지 못하도록 처리 필요)  
- [ ] 4. 성능테스트 후 성능 개선하기  
- [ ] 5. 파일 업/다운로드 시 한글파일일 경우 발생하는 오류 해결하기  
- [ ] 6. 조회시 페이징 처리하기  
- [ ] 7. 파일/폴더 조회시 응답형식 수정하기(파일과 폴더 응답 클래스를 MyFileResponse와 FolderResponse로 분리하지않고  파일인지 폴더인지 구분할수있는 값을 추가하여 하나로 통일하기)  
- [ ] 8. 폴더 다운로드 기능(zip형식으로 다운) 추가하기  
- [ ] 9. 다운로드 진행사항 볼수있도록 추가하기  
- [ ] 10. 파일 다운로드 경로 관련 문제 해결하기(브라우저에서 설정한 경로 외에도 클래스패스에 파일이 함께 다운로드 되고 있음)  
